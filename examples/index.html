<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
    <title>Popdeem Javascript SDK Sample</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <script>
      window.fbAsyncInit = function() {
        FB.init({
          appId: "FB-APP-ID",
          autoLogAppEvents: true,
          xfbml: true,
          version: "v4.0"
        });
      };
    </script>
    <script
      async
      defer
      src="https://connect.facebook.net/en_US/sdk.js">
    </script>
    <script>
      window.onload = function() {
        pd.init("API_KEY");
      };

      function setlog(data) {
        const logArea = document.getElementById("popdeem-log");
        logArea.value = data;
      }
      function showLoading() {
        const logArea = document.getElementById("loading");
        logArea.style.visibility = "visible";
      }
      function hideLoading() {
        const logArea = document.getElementById("loading");
        logArea.style.visibility = "hidden";
      }
      function registerUserwithFacebook() {
        FB.login(function(response) {
          if (response.authResponse) {
            const accessToken = response.authResponse.accessToken;
            const userID = response.authResponse.userID;
            registerUser("facebook", accessToken, userID)
          } else {
            console.log("User cancelled login or did not fully authorize.");
          }
        });
      }
      function registerUser(socialMediaType, accessToken, userID,thirdPartyUserToken) {
        showLoading();
        pd.registerUser(socialMediaType, accessToken, userID, thirdPartyUserToken)
          .then(result => {
            setlog(JSON.stringify(result.data));
            hideLoading();
          })
          .catch(function(error) {
            setlog(JSON.stringify(error.response ? error.response.data: error));
            hideLoading();
          });
      }
      function userInfo() {
        showLoading();
        pd.userInfo()
          .then(result => {
            setlog(JSON.stringify(result.data));
            hideLoading();
          })
          .catch(function(error) {
            setlog(JSON.stringify(error.response ? error.response.data: error));
            hideLoading();
          });
      }
      function rewards() {
        showLoading();
        pd.rewards()
          .then(result => {
            setlog(JSON.stringify(result.data));
            hideLoading();
          })
          .catch(function(error) {
            setlog(JSON.stringify(error.response ? error.response.data: error));
            hideLoading();
          });
      }
      function activity() {
        showLoading();
        pd.activity()
          .then(result => {
            setlog(JSON.stringify(result.data));
            hideLoading();
          })
          .catch(function(error) {
            setlog(JSON.stringify(error.response ? error.response.data: error));
            hideLoading();
          });
      }
      function DisconnectSocialAccount() {
        showLoading();
        const access_token = "EAAZA2c15Dn9ABAPsBmvwVVkqZAfaznyqf7tqieJI12fvC8hypeluUAkQJeTUYZBqgb70wfN74Q6NxYSzogFrIYxTSW5GuQU3mzaxSkWtX3xc5gjkonrbdLPYzCrZAqD7PEtUX1Po7ypOpaop0GndC4v6okuBCcO0TLh1bee1f8vBeOuoyM8Ca61pcYRAZASojFjRjMpaa9q2tzUXD1yMeTMZBftlzmFUAUwgW2mLnEcwZDZD"
        pd.DisconnectSocialAccount('facebook', access_token,"2424203447860834" )
          .then(result => {
            setlog(JSON.stringify(result.data));
            hideLoading();
          })
          .catch(function(error) {
            setlog(JSON.stringify(error.response ? error.response.data: error));
            hideLoading();
          });
      }
     
    </script>
    <script>
      function authenticateInstagram() {
        var CLIENT_ID = "INSTAGRAM-CLIEND-ID";
        var REDIRECT_URI = "https://localhost:3000/instagram-popdeem.html";
        var url = "https://api.instagram.com/oauth/authorize/?client_id="+ CLIENT_ID + "&redirect_uri="+REDIRECT_URI+"&response_type=code&scope=basic";
        // Pop-up window size, change if you want
        var popupWidth = 700,
            popupHeight = 500,
            popupLeft = (window.screen.width - popupWidth) / 2,
            popupTop = (window.screen.height - popupHeight) / 2;
        // Url needs to point to instagram_auth.php
        var popup = window.open('instagram-popdeem.html', '', 'width='+popupWidth+',height='+popupHeight+',left='+popupLeft+',top='+popupTop+'');
        popup.onload = function() { 
          if(window.location.hash.length == 0) {
              popup.open(url, '_self');
          }

        }

      };
      function registerUserwithInstagram() {
         const access_token = window.localStorage.getItem('InstagramToken')
         const id = window.localStorage.getItem('InstagramUserId') 
         if(access_token) {
            registerUser("instagram", access_token, id)
         }else {
          authenticateInstagram()
         }
       
      }
      function updateUser() {
        showLoading();

        const thirdPartyToken = "splio-third-party-token";

        pd.updateUser(thirdPartyToken)
          .then(result => {
            setlog(JSON.stringify(result.data));
            hideLoading();
          })
          .catch(function(error) {
            setlog(JSON.stringify(error.response ? error.response.data: error));
            hideLoading();
          });
      }
    </script>
    <div
      class="container d-flex justify-content-center align-items-center flex-column"
      style="padding-top: 50px;"
    >

    <center><img src="img/popdeem.png"></center>
      <h3 class="m-4" style="padding-bottom: 20px;">
        Popdeem Javascript SDK Sample
      </h3>
      <div class="d-flex flex-column">
        <button class="btn btn-primary mb-2" onclick="registerUserwithFacebook()">
          Login with Facebook & Register Popdeem User
        </button>
        <button class="btn btn-primary mb-2" onclick="registerUserwithInstagram()">
           Login with Instagram & Register Popdeem User
        </button>

        </br>

        <button class="btn btn-primary mb-2" onclick="rewards()">
          Get Social Rewards
        </button>
        <button class="btn btn-primary mb-2" onclick="activity()">
          GET Social Activity
        </button>
        <button class="btn btn-primary mb-2" onclick="userInfo()">
          GET Popdeem User Info
        </button>

        </br>

        <button class="btn btn-primary mb-2" onclick="DisconnectSocialAccount()">
          Disconnect User
        </button>
        <button class="btn btn-primary mb-2" onclick="updateUser()">
          Update Existing Popdeem User
        </button>
        <button class="btn btn-primary mb-2">
          Connect Social Account to Existing Popdeem User
        </button>

        <textarea
          id="popdeem-log"
          class="mt-5"
          style="height: 200px;"
          placeholder="PopDeem Logs"
        ></textarea>
      </div>
    </div>
    <div
      id="loading"
      class="d-flex justify-content-center align-items-center"
      style="position: absolute; top:0;bottom:0;right:0;left:0;background-color: rgba(255,255,255,0.5);visibility:hidden;"
    >
      <div class="spinner-grow text-primary" role="status">
        <span class="sr-only">Loading...</span>
      </div>
      <div class="spinner-grow text-danger" role="status">
        <span class="sr-only">Loading...</span>
      </div>
      <div class="spinner-grow text-warning" role="status">
        <span class="sr-only">Loading...</span>
      </div>
    </div>
  </body>
</html>
